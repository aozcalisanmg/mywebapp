name: Trigger Workflow

on:
  push:
    branches:
      - development
      - stage
      - main

env: 
  REPO_NAME: ${{ github.event.repository.name }}
  GITHUB_TOKEN: ${{ secrets.WORKFLOW_TOKEN }}  

jobs:
  trigger_external_workflow:
    runs-on: mg-runner

    steps:
      - name: Checkout this repository
        uses: actions/checkout@v2

      - name: Set workflow file name
        id: set-workflow
        run: echo "WORKFLOW_FILE=${{ env.REPO_NAME }}.yaml" >> $GITHUB_ENV

      - name: Trigger Workflow in Workflows Repository
        run: |
          curl -L \
            -X POST \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: Bearer $WORKFLOW_TOKEN" \
            -H "X-GitHub-Api-Version: 2022-11-28" \
            https://api.github.com/repos/aozcalisanmg/workflows/actions/workflows/${{ env.WORKFLOW_FILE }}/dispatches \
            -d '{"ref":"main"}'
